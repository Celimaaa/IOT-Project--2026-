<!DOCTYPE html>
<html>
<head>
  <title>Plant Dashboard</title>
    <script type="module">
    import { initializeApp } 
        from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";

    import { 
        getDatabase, 
        ref, 
        set, 
        onValue, 
        query, 
        limitToLast 
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
        // fire base api here!!!!!!!!!
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ===== SENSOR DATA =====
    const sensorRef = ref(db, "sensorData");
    onValue(sensorRef, (snapshot) => {
        const data = snapshot.val();
        if (!data) return;

        document.getElementById("temp").innerText = data.temperature + " Â°C";
        document.getElementById("hum").innerText = data.humidity + " %";
        document.getElementById("soil").innerText = data.soil;
    });

    // ===== DEVICE STATUS =====
    const statusRef = ref(db, "deviceStatus");
    onValue(statusRef, (snapshot) => {
        const data = snapshot.val();
        if (!data) return;

        document.getElementById("pumpStatus").innerText = data.pump ? "ON" : "OFF";
        document.getElementById("fanStatus").innerText = data.fan ? "ON" : "OFF";
        document.getElementById("lightStatus").innerText = data.light ? "ON" : "OFF";
    });

    // ===== CONTROL FUNCTIONS =====
    window.setPump = (state) => {
        set(ref(db, "control/pump"), state);
    };

    window.setFan = (state) => {
        set(ref(db, "control/fan"), state);
    };

    window.setLightMode = (mode) => {
        set(ref(db, "control/lightMode"), mode);
    };

    // ===== HISTORY (Latest 20) =====
    const historyRef = query(ref(db, "history"), limitToLast(20));

    onValue(historyRef, (snapshot) => {
        const container = document.getElementById("historyContainer");
        container.innerHTML = "";

        if (!snapshot.exists()) return;

        let records = [];
        snapshot.forEach(child => {
        records.push(child.val());
        });

        // Sort by timestamp if exists
        records.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));

        records.forEach(data => {
        const div = document.createElement("div");
        div.style.borderBottom = "1px solid #ddd";
        div.style.padding = "8px";

        div.innerHTML = `
            <strong>${data.time || "--"}</strong><br>
            ðŸŒ¡ ${data.temperature}Â°C | 
            ðŸ’§ Soil: ${data.soil} | 
            Pump: ${data.pump ? "ON" : "OFF"} | 
            Fan: ${data.fan ? "ON" : "OFF"} | 
            Light: ${data.light ? "ON" : "OFF"}
        `;

        container.appendChild(div);
        });
    });

    </script>

  <style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f4f6f9;
    margin: 0;
    padding: 0;
}

/* Main container */
.container {
    max-width: 1200px;
    margin: 40px auto;
    padding: 20px;
}

/* Title */
h2 {
    text-align: center;
    margin-bottom: 40px;
    color: #2c3e50;
}

/* Card layout */
.dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 25px;
}

/* Card style */
.card {
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    transition: 0.2s ease;
}

.card:hover {
    transform: translateY(-3px);
}

/* Card title */
.card h2 {
    margin-top: 0;
    font-size: 18px;
    color: #34495e;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
}

/* Sensor value */
.value {
    font-size: 28px;
    font-weight: bold;
    margin: 15px 0;
    color: #27ae60;
}

/* Buttons */
button {
    padding: 10px 16px;
    margin: 5px 5px 0 0;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: 0.2s ease;
}

button.on {
    background-color: #2ecc71;
    color: white;
}

button.off {
    background-color: #e74c3c;
    color: white;
}

button.auto {
    background-color: #3498db;
    color: white;
}

button:hover {
    opacity: 0.85;
}

/* History table */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    font-size: 14px;
}

th {
    background-color: #2c3e50;
    color: white;
    padding: 10px;
}

td {
    padding: 8px;
    text-align: center;
    border-bottom: 1px solid #ddd;
}

tr:hover {
    background-color: #f2f2f2;
}

/* Status badge */
.badge {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: bold;
}

.badge-on {
    background: #2ecc71;
    color: white;
}

.badge-off {
    background: #e74c3c;
    color: white;
}
</style>
</head>

<body>

<h2>ðŸŒ± Plant IoT Dashboard</h2>

<div class="container">
    <div class="dashboard">
        <div class="card">
        <h3>ðŸŒ¡ Sensor Data</h3>
        <p>Temperature: <span id="temp">--</span></p>
        <p>Humidity: <span id="hum">--</span></p>
        <p>Soil Moisture: <span id="soil">--</span></p>
        </div>

        <div class="card">
        <h3>ðŸ’§ Pump</h3>
        <p>Status: <span id="pumpStatus">--</span></p>
        <button class="on" onclick="setPump(true)">ON</button>
        <button class="off" onclick="setPump(false)">OFF</button>
        </div>

        <div class="card">
        <h3>ðŸŒ¬ Fan</h3>
        <p>Status: <span id="fanStatus">--</span></p>
        <button class="on" onclick="setFan(true)">ON</button>
        <button class="off" onclick="setFan(false)">OFF</button>
        </div>

        <div class="card">
        <h3>ðŸ’¡ Light Control</h3>
        <p>Status: <span id="lightStatus">--</span></p>
        <select onchange="setLightMode(this.value)">
            <option value="AUTO">Auto</option>
            <option value="ON">Manual ON</option>
            <option value="OFF">Manual OFF</option>
        </select>
        </div>

        <div class="card">
        <h3>ðŸ“œ History (Latest 20)</h3>
        <div id="historyContainer" 
            style="max-height: 300px; overflow-y: auto; text-align:left;">
        </div>
        </div>
        </div>
</div>

</body>
</html>